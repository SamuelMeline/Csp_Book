{% extends 'base.html.twig' %}

{% block title %}Csp_Book - Mes panoplies
{% endblock %}

{% block body %}
<main class="content">
	<div class="my-items">
		<h1 class="page-title">Mes panoplies</h1>

		{% for flashMessage in app.session.flashbag.get('success') %}
			<div class="flash-success">
				{{ flashMessage }}
			</div>
		{% endfor %}
		<div class="item-count">
			<p>
				Il y a
				{{ builds.getTotalItemCount }}
				panoplies
			</p>
		</div>
		<a href="{{ path('build.new') }}" class="create-item-btn">Créer une panoplie</a>
		<table class="item-table">
			<thead>
				<tr>
					<th>Numéro</th>
					<th>Nom</th>
					<th>Items</th>
					<th>Prix</th>
					<th>Difficulté</th>
					<th>Date de création</th>
					<th>Edition</th>
					<th>Suppression</th>
				</tr>
			</thead>
			<tbody>
				{% for build in builds %}
					<tr>
						<td>{{ build.id }}</td>
						<td>{{ build.name }}</td>
						<td>
							{# Récupérer l'image de l'item ajouté #}
							{% for item in build.items %}
								{% if item.image is not null %}
									<img src="{{ asset('images/' ~ item.image) }}" alt="{{ item.name }}" class="item-image">
								{% endif %}
							{% endfor %}
						</td>
						<td>
							{% if build.price is null %}
								Non renseigné
							{% else %}
								<div class="build-price-container">
									<span class="build-price">{{ build.price }}</span>
									<img src="{{ asset('images/gold.png') }}" alt="{{ build.name }}" class="gold-image">
								</div>
							{% endif %}
						</td>
						<td>
							{% if build.difficulty is null %}
								Non renseigné
							{% else %}
								{{ build.difficulty }}
							{% endif %}
						</td>
						<td>{{ build.createdAt|date('d/m/Y') }}</td>
						<td>
							<a href="{{ path('build.edit', { id : build.id }) }}" class="edit-button">Modifier</a>
						</td>
						<td>
							<a href="{{ path('build.delete', { id : build.id }) }}" class="delete-button" data-url="{{ path('build.delete', {id: build.id}) }}">Supprimer</a>
						</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
		<div class="navigation">
			{{ knp_pagination_render(builds) }}
		</div>
	</div>
</main>
{% endblock %}
